<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisor Registration</title>
    <link rel="icon" href="/images/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .navbar { 
            background-color: #e4a801; 
            padding: 10px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .navbar a { 
            color: white; 
            text-decoration: none; 
            padding: 10px 20px; 
            font-weight: bold; 
            text-transform: uppercase; 
        }
        .navbar a:hover { 
            background-color: #d27c00; 
        }
        .card { 
            background: #ffffff; 
            border: 1px solid #e5e7eb; 
            border-radius: 12px; 
            padding: 24px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.06); 
        }
        .input { 
            border: 1px solid #d1d5db; 
            border-radius: 8px; 
            padding: 12px; 
            width: 100%; 
        }
        .btn { 
            background-color: #e4a801; 
            color: white; 
            border-radius: 8px; 
            padding: 12px; 
            border: none; 
            cursor: pointer; 
            font-weight: 600; 
            width: 100%; 
        }
        .btn:hover { 
            background-color: #d27c00; 
        }
        .error { 
            margin-top: 12px; 
            color: #b91c1c; 
            display: none; 
        }
        .success { 
            margin-top: 12px; 
            color: #16a34a; 
            display: none; 
        }
        .back-to-home {
            position: absolute;
            top: 2rem;
            left: 2rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        .back-to-home:hover {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            transform: translateX(-5px);
            text-decoration: none;
        }
    </style>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.tailwindcss.com; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self'">
</head>
<body class="bg-gray-50">
    <a href="/login-portal.html" class="back-to-home">
        <i class="fas fa-arrow-left me-2"></i>
        Back to Home
    </a>

    <div class="navbar">
        <div class="logo flex items-center gap-2">
            <img src="/images/logo.png" style="width:40px;height:auto;border-radius:8px;" alt="logo">
            <span class="text-white font-bold">Golden Dish Catering</span>
        </div>
        <div>
            <a href="/">Home</a>
            <a href="/delivery/supervisor/login">Login</a>
        </div>
    </div>

    <header style="background-image: url('/images/header-image.jpg'); background-size: cover; background-position: center; padding: 60px 0; text-align: center; color: white;">
        <h1>Supervisor Registration</h1>
        <p>Create a new supervisor account</p>
    </header>

    <main class="max-w-md mx-auto p-4">
        <div class="card">
            <form id="signupForm" class="grid gap-3">
                <label for="regName" class="font-semibold">Full Name</label>
                <input id="regName" name="name" type="text" required class="input" placeholder="Your full name">

                <label for="regEmail" class="font-semibold">Email</label>
                <input id="regEmail" name="email" type="email" required class="input" placeholder="name@example.com">

                <label for="regPassword" class="font-semibold">Password</label>
                <input id="regPassword" name="password" type="password" minlength="6" required class="input" placeholder="Minimum 6 characters">

                <label for="regConfirmPassword" class="font-semibold">Confirm Password</label>
                <input id="regConfirmPassword" name="confirmPassword" type="password" minlength="6" required class="input" placeholder="Confirm your password">

                <button id="signupBtn" type="submit" class="btn">Create Supervisor Account</button>
                <div id="signupMsg" class="error" role="alert"></div>
            </form>

            <hr class="my-6">
            <div class="text-center">
                <p class="text-gray-600">Already have an account?</p>
                <a href="/delivery/supervisor/login" class="text-blue-600 hover:text-blue-800 font-semibold">Sign in here</a>
            </div>
        </div>
    </main>

    <script>
        // Registration form handler
        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const msg = document.getElementById('signupMsg');
            const btn = document.getElementById('signupBtn');
            
            // Clear previous messages
            msg.style.display = 'block';
            msg.style.color = '#b91c1c';
            msg.textContent = '';
            btn.disabled = true; 
            btn.textContent = 'Creating Account...';
            
            try {
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                
                // Validate password match
                if (password !== confirmPassword) {
                    msg.textContent = 'Passwords do not match.';
                    return;
                }
                
                const payload = {
                    name: document.getElementById('regName').value.trim(),
                    email: document.getElementById('regEmail').value.trim(),
                    password: password
                };
                
                if (!payload.name || !payload.email || !payload.password) {
                    msg.textContent = 'Please fill all fields.';
                    return;
                }
                
                const res = await fetch('/api/supervisors', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const text = await res.text();
                let data; 
                try { 
                    data = JSON.parse(text); 
                } catch { 
                    data = { message: text }; 
                }
                
                if (res.ok || res.status === 201) {
                    msg.style.color = '#16a34a';
                    msg.textContent = 'Account created successfully! You can now sign in.';
                    // Clear form
                    document.getElementById('signupForm').reset();
                    // Redirect to login after 2 seconds
                    setTimeout(() => {
                        window.location.href = '/delivery/supervisor/login';
                    }, 2000);
                } else {
                    msg.textContent = (data && data.message) ? data.message : ('Failed to create account. Status ' + res.status);
                }
            } catch (err) {
                msg.textContent = 'Network error: ' + err.message;
            } finally {
                btn.disabled = false; 
                btn.textContent = 'Create Supervisor Account';
            }
        });
    </script>
</body>
</html>
