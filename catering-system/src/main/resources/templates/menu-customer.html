<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Management - Modern Catering System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .menu-item-card {
            transition: transform 0.2s;
        }
        .menu-item-card:hover {
            transform: translateY(-2px);
        }
        .category-badge {
            font-size: 0.8rem;
        }
        .price-highlight {
            font-weight: bold;
            color: #28a745;
        }
        .status-badge {
            font-size: 0.75rem;
        }
        .featured-item {
            border: 2px solid #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #ffffff 100%);
        }
        .unavailable-item {
            opacity: 0.6;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">
                <i class="fas fa-utensils me-2"></i>Modern Catering System
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard">
                    <i class="fas fa-home me-1"></i>Dashboard
                </a>
                <a class="nav-link" href="/customers">
                    <i class="fas fa-users me-1"></i>Customers
                </a>
                <a class="nav-link active" href="/menu">
                    <i class="fas fa-book me-1"></i>Menu
                </a>
                <a class="nav-link" href="/orders">
                    <i class="fas fa-shopping-cart me-1"></i>Orders
                </a>
                <a class="nav-link" href="/reports">
                    <i class="fas fa-chart-bar me-1"></i>Reports
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h1 class="h2 mb-1">
                    <i class="fas fa-book text-primary me-2"></i>Menu Management
                </h1>
                <p class="text-muted mb-0">Manage your restaurant menu items, pricing, and availability</p>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMenuItemModal">
                    <i class="fas fa-plus me-2"></i>Add Menu Item
                </button>
            </div>
        </div>

        <!-- Filter and Search Section -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" class="form-control" id="searchInput" placeholder="Search menu items...">
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="categoryFilter">
                    <option value="">All Categories</option>
                    <option th:each="category : ${categories}" th:value="${category}" th:text="${category}"></option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="statusFilter">
                    <option value="">All Items</option>
                    <option value="available">Available Only</option>
                    <option value="unavailable">Unavailable</option>
                    <option value="featured">Featured</option>
                </select>
            </div>
        </div>

        <!-- Quick Filter Buttons -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="showAllItems()">All Items</button>
                    <button type="button" class="btn btn-outline-success" onclick="showAvailableItems()">Available Only</button>
                    <button type="button" class="btn btn-outline-warning" onclick="showUnavailableItems()">Unavailable Only</button>
                    <button type="button" class="btn btn-outline-info" onclick="showFeaturedItems()">Featured Only</button>
                </div>
            </div>
        </div>

        <!-- Menu Items Grid -->
        <div class="row" id="menuItemsGrid">
            <div th:each="item : ${menuItems}" class="col-lg-4 col-md-6 mb-4" th:id="'menu-item-' + ${item.id}">
                <div class="card menu-item-card h-100" 
                     th:classappend="${item.isFeatured ? 'featured-item' : ''} + ' ' + ${!item.isAvailable ? 'unavailable-item' : ''}">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span class="badge category-badge bg-secondary" th:text="${item.category}">Category</span>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-sm" 
                                    th:onclick="'viewMenuItem(' + ${item.id} + ')'"
                                    title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning btn-sm" 
                                    th:onclick="'editMenuItem(' + ${item.id} + ')'"
                                    title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" 
                                    th:onclick="'deleteMenuItem(' + ${item.id} + ')'"
                                    title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title mb-0" th:text="${item.name}">Item Name</h5>
                            <span class="price-highlight" th:text="'$' + ${#numbers.formatDecimal(item.price, 1, 2)}">$0.00</span>
                        </div>
                        
                        <p class="card-text text-muted small" th:text="${item.shortDescription}">Short description</p>
                        
                        <div class="mb-2">
                            <span th:if="${item.cuisineType}" class="badge bg-info me-1" th:text="${item.cuisineType}">Cuisine</span>
                            <span th:if="${item.dietaryInfo}" class="badge bg-success me-1" th:text="${item.dietaryInfo}">Dietary</span>
                            <span th:if="${item.spiceLevel}" class="badge bg-warning me-1" th:text="${item.spiceLevel}">Spice</span>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="status-badge badge" 
                                      th:classappend="${item.isAvailable} ? 'bg-success' : 'bg-danger'"
                                      th:text="${item.isAvailable} ? 'Available' : 'Unavailable'">Status</span>
                                <span th:if="${item.isFeatured}" class="status-badge badge bg-warning ms-1">Featured</span>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-sm" 
                                        th:classappend="${item.isAvailable} ? 'btn-outline-secondary' : 'btn-outline-success'"
                                        th:onclick="'toggleAvailability(' + ${item.id} + ')'"
                                        th:text="${item.isAvailable} ? 'Hide' : 'Show'">Toggle</button>
                                <button class="btn btn-sm" 
                                        th:classappend="${item.isFeatured} ? 'btn-warning' : 'btn-outline-warning'"
                                        th:onclick="'toggleFeatured(' + ${item.id} + ')'">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-5" style="display: none;">
            <i class="fas fa-book fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No menu items found</h4>
            <p class="text-muted">Try adjusting your search criteria or add a new menu item.</p>
        </div>
    </div>

    <!-- Add Menu Item Modal -->
    <div class="modal fade" id="addMenuItemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>Add New Menu Item
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addMenuItemForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemName" class="form-label">Item Name *</label>
                                <input type="text" class="form-control" id="itemName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemCategory" class="form-label">Category *</label>
                                <select class="form-select" id="itemCategory" required>
                                    <option value="">Select Category</option>
                                    <option th:each="category : ${categories}" th:value="${category}" th:text="${category}"></option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemPrice" class="form-label">Price *</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="itemPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemCostPrice" class="form-label">Cost Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="itemCostPrice" step="0.01" min="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemCuisine" class="form-label">Cuisine Type</label>
                                <input type="text" class="form-control" id="itemCuisine" placeholder="e.g., Italian, Chinese">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemPrepTime" class="form-label">Prep Time (minutes)</label>
                                <input type="number" class="form-control" id="itemPrepTime" min="0">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemServingSize" class="form-label">Serving Size</label>
                                <input type="text" class="form-control" id="itemServingSize" placeholder="e.g., 1 plate, 2 pieces">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemCalories" class="form-label">Calories per Serving</label>
                                <input type="number" class="form-control" id="itemCalories" min="0">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="itemShortDescription" class="form-label">Short Description</label>
                            <input type="text" class="form-control" id="itemShortDescription" placeholder="Brief description for display">
                        </div>
                        
                        <div class="mb-3">
                            <label for="itemDescription" class="form-label">Full Description</label>
                            <textarea class="form-control" id="itemDescription" rows="3" placeholder="Detailed description of the item"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemIngredients" class="form-label">Ingredients</label>
                                <textarea class="form-control" id="itemIngredients" rows="2" placeholder="List main ingredients"></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemAllergens" class="form-label">Allergens</label>
                                <textarea class="form-control" id="itemAllergens" rows="2" placeholder="List allergens (e.g., nuts, dairy)"></textarea>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="itemDietaryInfo" class="form-label">Dietary Information</label>
                                <select class="form-select" id="itemDietaryInfo">
                                    <option value="">Select dietary info</option>
                                    <option value="VEGETARIAN">Vegetarian</option>
                                    <option value="VEGAN">Vegan</option>
                                    <option value="GLUTEN_FREE">Gluten Free</option>
                                    <option value="DAIRY_FREE">Dairy Free</option>
                                    <option value="NUT_FREE">Nut Free</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="itemSpiceLevel" class="form-label">Spice Level</label>
                                <select class="form-select" id="itemSpiceLevel">
                                    <option value="">Select spice level</option>
                                    <option value="MILD">Mild</option>
                                    <option value="MEDIUM">Medium</option>
                                    <option value="HOT">Hot</option>
                                    <option value="EXTRA_HOT">Extra Hot</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="itemImageUrl" class="form-label">Image URL</label>
                            <input type="url" class="form-control" id="itemImageUrl" placeholder="https://example.com/image.jpg">
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="itemAvailable" checked>
                                    <label class="form-check-label" for="itemAvailable">
                                        Available
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="itemFeatured">
                                    <label class="form-check-label" for="itemFeatured">
                                        Featured Item
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Add Menu Item
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Menu Item Modal -->
    <div class="modal fade" id="editMenuItemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>Edit Menu Item
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="editMenuItemForm">
                    <input type="hidden" id="editItemId">
                    <div class="modal-body">
                        <!-- Same form fields as add modal, but with edit prefix -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editItemName" class="form-label">Item Name *</label>
                                <input type="text" class="form-control" id="editItemName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editItemCategory" class="form-label">Category *</label>
                                <select class="form-select" id="editItemCategory" required>
                                    <option value="">Select Category</option>
                                    <option th:each="category : ${categories}" th:value="${category}" th:text="${category}"></option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editItemPrice" class="form-label">Price *</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="editItemPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editItemCostPrice" class="form-label">Cost Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="editItemCostPrice" step="0.01" min="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editItemDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editItemDescription" rows="3"></textarea>
                        </div>
                        
        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editItemAvailable">
                                    <label class="form-check-label" for="editItemAvailable">
                                        Available
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="editItemFeatured">
                                    <label class="form-check-label" for="editItemFeatured">
                                        Featured Item
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Menu Item Modal -->
    <div class="modal fade" id="viewMenuItemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-eye me-2"></i>Menu Item Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="viewMenuItemContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let allMenuItems = [];
        let filteredItems = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadMenuItems();
            initializeEventListeners();
        });

        function loadMenuItems() {
            fetch('/menu/api/items')
                .then(response => response.json())
                .then(items => {
                    allMenuItems = items;
                    filteredItems = items;
                    displayMenuItems(items);
                })
                .catch(error => {
                    console.error('Error loading menu items:', error);
                    alert('Error loading menu items');
                });
        }

        function initializeEventListeners() {
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', filterMenuItems);
            document.getElementById('categoryFilter').addEventListener('change', filterMenuItems);
            document.getElementById('statusFilter').addEventListener('change', filterMenuItems);

            // Form submissions
            document.getElementById('addMenuItemForm').addEventListener('submit', handleAddMenuItem);
            document.getElementById('editMenuItemForm').addEventListener('submit', handleEditMenuItem);
        }

        function filterMenuItems() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredItems = allMenuItems.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.name.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                    (item.shortDescription && item.shortDescription.toLowerCase().includes(searchTerm));

                const matchesCategory = !categoryFilter || item.category === categoryFilter;

                let matchesStatus = true;
                if (statusFilter === 'available') {
                    matchesStatus = item.isAvailable;
                } else if (statusFilter === 'unavailable') {
                    matchesStatus = !item.isAvailable;
                } else if (statusFilter === 'featured') {
                    matchesStatus = item.isFeatured;
                }

                return matchesSearch && matchesCategory && matchesStatus;
            });

            displayMenuItems(filteredItems);
        }

        function displayMenuItems(items) {
            const grid = document.getElementById('menuItemsGrid');
            const emptyState = document.getElementById('emptyState');

            if (items.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                grid.style.display = 'flex';
                emptyState.style.display = 'none';
                
                // Clear the grid and rebuild it with all items
                grid.innerHTML = '';
                
                items.forEach(item => {
                    const itemElement = createMenuItemElement(item);
                    grid.appendChild(itemElement);
                });
            }
        }

        function createMenuItemElement(item) {
            const div = document.createElement('div');
            div.className = 'col-lg-4 col-md-6 mb-4';
            div.id = `menu-item-${item.id}`;
            
            const featuredClass = item.isFeatured ? 'featured-item' : '';
            const unavailableClass = !item.isAvailable ? 'unavailable-item' : '';
            
            div.innerHTML = `
                <div class="card menu-item-card h-100 ${featuredClass} ${unavailableClass}">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span class="badge category-badge bg-secondary">${item.category}</span>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-sm" 
                                    onclick="viewMenuItem(${item.id})" 
                                    title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning btn-sm" 
                                    onclick="editMenuItem(${item.id})" 
                                    title="Edit Item">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn ${item.isAvailable ? 'btn-outline-secondary' : 'btn-outline-success'} btn-sm" 
                                    onclick="toggleAvailability(${item.id})" 
                                    title="${item.isAvailable ? 'Make Unavailable' : 'Make Available'}">
                                <i class="fas ${item.isAvailable ? 'fa-eye-slash' : 'fa-eye'}"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" 
                                    onclick="deleteMenuItem(${item.id})" 
                                    title="Delete Item">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">
                            ${item.name}
                            ${item.isFeatured ? '<i class="fas fa-star text-warning ms-1"></i>' : ''}
                        </h5>
                        <p class="card-text">${item.shortDescription || item.description || 'No description available'}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="h5 text-primary mb-0">$${item.price.toFixed(2)}</span>
                            <span class="badge ${item.isAvailable ? 'bg-success' : 'bg-danger'}">
                                ${item.isAvailable ? 'Available' : 'Unavailable'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            return div;
        }

        function handleAddMenuItem(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                price: parseFloat(document.getElementById('itemPrice').value),
                costPrice: document.getElementById('itemCostPrice').value ? parseFloat(document.getElementById('itemCostPrice').value) : null,
                cuisineType: document.getElementById('itemCuisine').value || null,
                preparationTimeMinutes: document.getElementById('itemPrepTime').value ? parseInt(document.getElementById('itemPrepTime').value) : null,
                servingSize: document.getElementById('itemServingSize').value || null,
                caloriesPerServing: document.getElementById('itemCalories').value ? parseInt(document.getElementById('itemCalories').value) : null,
                shortDescription: document.getElementById('itemShortDescription').value || null,
                description: document.getElementById('itemDescription').value || null,
                ingredients: document.getElementById('itemIngredients').value || null,
                allergens: document.getElementById('itemAllergens').value || null,
                dietaryInfo: document.getElementById('itemDietaryInfo').value || null,
                spiceLevel: document.getElementById('itemSpiceLevel').value || null,
                imageUrl: document.getElementById('itemImageUrl').value || null,
                isAvailable: document.getElementById('itemAvailable').checked,
                isFeatured: document.getElementById('itemFeatured').checked
            };

            fetch('/menu/api/items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    alert('Menu item added successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('addMenuItemModal')).hide();
                    document.getElementById('addMenuItemForm').reset();
                    loadMenuItems();
                } else {
                    alert('Error: ' + data);
                }
            })
            .catch(error => {
                console.error('Error adding menu item:', error);
                alert('Error adding menu item: ' + error.message);
            });
        }

        function handleEditMenuItem(e) {
            e.preventDefault();
            
            const itemId = document.getElementById('editItemId').value;
            const formData = {
                name: document.getElementById('editItemName').value,
                category: document.getElementById('editItemCategory').value,
                price: parseFloat(document.getElementById('editItemPrice').value),
                costPrice: document.getElementById('editItemCostPrice').value ? parseFloat(document.getElementById('editItemCostPrice').value) : null,
                description: document.getElementById('editItemDescription').value || null,
                isAvailable: document.getElementById('editItemAvailable').checked,
                isFeatured: document.getElementById('editItemFeatured').checked
            };

            fetch(`/menu/api/items/${itemId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    alert('Menu item updated successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('editMenuItemModal')).hide();
                    loadMenuItems();
                } else {
                    alert('Error: ' + data);
                }
            })
            .catch(error => {
                console.error('Error updating menu item:', error);
                alert('Error updating menu item: ' + error.message);
            });
        }

        function viewMenuItem(id) {
            fetch(`/menu/api/items/${id}`)
                .then(response => response.json())
                .then(item => {
                    const content = `
                        <div class="row">
                            <div class="col-md-6">
                                <h5>${item.name}</h5>
                                <p><strong>Category:</strong> ${item.category}</p>
                                <p><strong>Price:</strong> $${item.price.toFixed(2)}</p>
                                <p><strong>Status:</strong> 
                                    <span class="badge ${item.isAvailable ? 'bg-success' : 'bg-danger'}">
                                        ${item.isAvailable ? 'Available' : 'Unavailable'}
                                    </span>
                                </p>
                                ${item.isFeatured ? '<p><strong>Featured:</strong> <i class="fas fa-star text-warning"></i> Yes</p>' : ''}
                            </div>
                            <div class="col-md-6">
                                <p><strong>Description:</strong></p>
                                <p>${item.description || 'No description available'}</p>
                                ${item.shortDescription ? `<p><strong>Short Description:</strong> ${item.shortDescription}</p>` : ''}
                            </div>
                        </div>
                    `;
                    document.getElementById('viewMenuItemContent').innerHTML = content;
                    const modal = new bootstrap.Modal(document.getElementById('viewMenuItemModal'));
                    modal.show();
                })
                .catch(error => {
                    console.error('Error fetching menu item:', error);
                    alert('Error loading menu item details');
                });
        }

        function editMenuItem(id) {
            fetch(`/menu/api/items/${id}`)
                .then(response => response.json())
                .then(item => {
                    document.getElementById('editItemId').value = item.id;
                    document.getElementById('editItemName').value = item.name;
                    document.getElementById('editItemCategory').value = item.category;
                    document.getElementById('editItemPrice').value = item.price;
                    document.getElementById('editItemCostPrice').value = item.costPrice || '';
                    document.getElementById('editItemDescription').value = item.description || '';
                    document.getElementById('editItemAvailable').checked = item.isAvailable;
                    document.getElementById('editItemFeatured').checked = item.isFeatured;
                    
                    const modal = new bootstrap.Modal(document.getElementById('editMenuItemModal'));
                    modal.show();
                })
                .catch(error => {
                    console.error('Error fetching menu item:', error);
                    alert('Error loading menu item for editing');
                });
        }

        function deleteMenuItem(id) {
            if (confirm('Are you sure you want to delete this menu item?')) {
                fetch(`/menu/api/items/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        alert('Menu item deleted successfully!');
                        loadMenuItems();
                    } else {
                        throw new Error('Failed to delete menu item');
                    }
                })
                .catch(error => {
                    console.error('Error deleting menu item:', error);
                    alert('Error deleting menu item');
                });
            }
        }

        function toggleAvailability(id) {
            fetch(`/menu/api/items/${id}/toggle-availability`, {
                method: 'PUT'
            })
            .then(response => response.json())
            .then(item => {
                alert(`Menu item ${item.isAvailable ? 'made available' : 'hidden'} successfully!`);
                loadMenuItems();
            })
            .catch(error => {
                console.error('Error toggling availability:', error);
                alert('Error updating availability: ' + error.message);
            });
        }

        function toggleFeatured(id) {
            fetch(`/menu/api/items/${id}/toggle-featured`, {
                method: 'PUT'
            })
            .then(response => response.json())
            .then(item => {
                alert(`Menu item ${item.isFeatured ? 'marked as featured' : 'removed from featured'} successfully!`);
                loadMenuItems();
            })
            .catch(error => {
                console.error('Error toggling featured status:', error);
                alert('Error updating featured status: ' + error.message);
            });
        }

        // Quick filter functions
        function showAllItems() {
            document.getElementById('statusFilter').value = '';
            filterMenuItems();
        }

        function showAvailableItems() {
            document.getElementById('statusFilter').value = 'available';
            filterMenuItems();
        }

        function showUnavailableItems() {
            document.getElementById('statusFilter').value = 'unavailable';
            filterMenuItems();
        }

        function showFeaturedItems() {
            document.getElementById('statusFilter').value = 'featured';
            filterMenuItems();
        }
    </script>
</body>
</html>